# 도면 수정 및 변경 추적하기
건설 현장에서는 도면이 짧은 주기로 계속 바뀝니다. 파일명 규칙, 스캔 품질은 제각각, 누가 어디를 어떻게 고쳤는지 일일이 눈으로 확인하긴 벅찹니다. 우리는 이 혼란 속에서 작지만 단단한 자동화를 통해 질서를 찾고자 합니다.
<br>
## 최종 목표 
`1차 업로드(first_upload)` 폴더의 원본 도면과 `2차 업로드(second_upload)` 폴더의 수정된 도면들을 비교하여, 어떤 도면이 서로 짝인지 를 찾고, 해당 도면 쌍에 대해 무엇이 바뀌었는지 정확하고 찾아내는 파이프라인을 설계하고 구현합니다.

## out/ 폴더 개요

이 폴더는 도면 비교 결과물 전체가 저장되는 결과 저장소임  
즉, 이 안에는 “매칭 결과”, “변경 영역 이미지”, “요약 통계”가 모두 들어감

실행 후 구조는 아래처럼 구성됨

out/
├── matched_pairs.csv       ← (1) 도면 매칭 결과 테이블  
├── diff_summary.csv        ← (2) 변경 탐지 요약 테이블  
├── diff_overlay/           ← (3) 도면 위에 변경 부분 시각화한 이미지  

---

### matched_pairs.csv

**도면 매칭(1차 vs 2차)** 단계의 결과

| 컬럼 | 설명 |
|------|------|
| v1 | 1차 업로드 도면 파일 경로 |
| v2 | 해당 도면과 가장 유사한 2차 업로드 도면 경로 |
| ssim | 두 이미지 간 구조적 유사도 점수 (0~1, 1에 가까울수록 동일) |

**예시:**

| v1 | v2 | ssim |
|----|----|------|
| first_upload/92c5a0...png | second_upload/48a979...png | 0.985 |
| first_upload/a479fc...png | second_upload/4ff0f5...png | 0.912 |

이 파일을 보면, 어떤 도면이 어떤 도면과 짝을 이루는지 알 수 있음  
즉, “이 도면은 이 도면의 수정본이구나”를 정리한 표 느낌

---

### diff_summary.csv

**변경 탐지 결과 요약**

이 파일은 각 도면 쌍별 변경 분석 결과를 수치로 요약한 테이블 느낌

| 컬럼 | 설명 |
|------|------|
| v1 | 1차 업로드 도면 경로 |
| v2 | 짝지어진 2차 업로드 도면 경로 |
| ssim | 두 도면의 구조적 유사도 |
| change_ratio | 전체 픽셀 중 변경된 픽셀의 비율 (0~1) |

**예시:**

| v1 | v2 | ssim | change_ratio |
|----|----|------|--------------|
| first_upload/92c5a0...png | second_upload/48a97...png | 0.98 | 0.0021 |
| first_upload/aa9f13...png | second_upload/b9868...png | 0.89 | 0.0462 |

이 파일을 보면 “어떤 도면이 얼마나 많이 바뀌었는지” 한눈에 볼 수 있음  
예를 들어 `change_ratio`가 0.05 이상이면, 전체 도면 중 약 5% 이상이 바뀌었다는 뜻 느낌  
→ 변경이 큰 도면을 자동으로 선별할 때 유용함

---

### diff_overlay/

**도면 위에 변경 영역을 빨간색으로 오버레이한 이미지 느낌**

- 파일명 예시:  
  `diff_overlay/92c5a0..._overlay.png`

원본 도면(1차)을 배경으로 하고  
변경된 영역은 **빨간색 (RGB [255,0,0])** 으로 표시됨

**예시**  
회색 도면 위에 빨간색으로 “추가되거나 삭제된” 부분이 하이라이트된 이미지 느낌

이 파일을 열어보면  
“눈으로 바로 어디가 바뀌었는지” 한눈에 확인 가능함  
(보고서용, 현장 담당자 피드백용 활용 가능)

---

### 정리: 각 파일의 역할 요약표

| 폴더/파일 | 용도 | 주요 활용 |
|------------|------|------------|
| matched_pairs.csv | 도면 쌍 매칭 결과 | 어떤 도면끼리 비교되었는지 확인 느낌 |
| diff_summary.csv | 변경 탐지 요약 | 변경량 순 정렬, 변경 많은 도면 찾기 느낌 |
| diff_overlay/ | 도면 위 변경 시각화 | 결과 시각화 및 리포트용 이미지 느낌 |

---

### 결과 해석 예시

| 상황 | 해석 |
|------|------|
| `ssim ≈ 1.0`, `change_ratio ≈ 0.0` | 거의 동일한 도면 (수정 없음) 느낌 |
| `ssim < 0.9`, `change_ratio > 0.03` | 변경이 많은 도면 (수정 다수) 느낌 |
| `ssim` 높지만 `change_ratio` 높음 | 작은 위치 변화/기울기 차이로 인한 오탐 가능 → alignment 개선 필요 느낌 |
